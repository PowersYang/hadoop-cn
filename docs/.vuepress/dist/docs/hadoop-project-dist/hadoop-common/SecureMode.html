<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hadoop in Secure Mode | Hadoop中文网</title>
    <meta name="description" content="Hadoop官方文档中文社区">
    <link rel="icon" href="/hadoop.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.fefea12e.css" as="style"><link rel="preload" href="/assets/js/app.03e63b66.js" as="script"><link rel="preload" href="/assets/js/2.fd33e103.js" as="script"><link rel="preload" href="/assets/js/46.4e18b7fe.js" as="script"><link rel="prefetch" href="/assets/js/10.0dbc29ee.js"><link rel="prefetch" href="/assets/js/100.51e7458e.js"><link rel="prefetch" href="/assets/js/101.cab336f3.js"><link rel="prefetch" href="/assets/js/102.d7e40b1a.js"><link rel="prefetch" href="/assets/js/103.3cd23502.js"><link rel="prefetch" href="/assets/js/104.a263cbd3.js"><link rel="prefetch" href="/assets/js/105.1cf856b7.js"><link rel="prefetch" href="/assets/js/106.1bd66c2f.js"><link rel="prefetch" href="/assets/js/107.7acc52af.js"><link rel="prefetch" href="/assets/js/108.096bf626.js"><link rel="prefetch" href="/assets/js/109.91d5ec0d.js"><link rel="prefetch" href="/assets/js/11.84130fe4.js"><link rel="prefetch" href="/assets/js/110.602bc28b.js"><link rel="prefetch" href="/assets/js/111.490d917f.js"><link rel="prefetch" href="/assets/js/112.dcdb6f77.js"><link rel="prefetch" href="/assets/js/113.0a64a78e.js"><link rel="prefetch" href="/assets/js/114.97ce2cfb.js"><link rel="prefetch" href="/assets/js/115.719819cf.js"><link rel="prefetch" href="/assets/js/116.606be43b.js"><link rel="prefetch" href="/assets/js/117.5f1db751.js"><link rel="prefetch" href="/assets/js/118.4c8b3331.js"><link rel="prefetch" href="/assets/js/119.756df93e.js"><link rel="prefetch" href="/assets/js/12.a85df2ad.js"><link rel="prefetch" href="/assets/js/120.21755a3d.js"><link rel="prefetch" href="/assets/js/121.86335dec.js"><link rel="prefetch" href="/assets/js/122.68c84b42.js"><link rel="prefetch" href="/assets/js/123.26f2d157.js"><link rel="prefetch" href="/assets/js/124.b8bb5eac.js"><link rel="prefetch" href="/assets/js/125.d3748b6f.js"><link rel="prefetch" href="/assets/js/126.74a59909.js"><link rel="prefetch" href="/assets/js/127.e75ea051.js"><link rel="prefetch" href="/assets/js/128.86691d41.js"><link rel="prefetch" href="/assets/js/129.1b73844b.js"><link rel="prefetch" href="/assets/js/13.5cc92b07.js"><link rel="prefetch" href="/assets/js/14.23af424b.js"><link rel="prefetch" href="/assets/js/15.d44d7e96.js"><link rel="prefetch" href="/assets/js/16.9433ad8d.js"><link rel="prefetch" href="/assets/js/17.e88b2671.js"><link rel="prefetch" href="/assets/js/18.621a61a9.js"><link rel="prefetch" href="/assets/js/19.c2269943.js"><link rel="prefetch" href="/assets/js/20.97a13073.js"><link rel="prefetch" href="/assets/js/21.cfddb2e0.js"><link rel="prefetch" href="/assets/js/22.3fc2e173.js"><link rel="prefetch" href="/assets/js/23.b44f9aaa.js"><link rel="prefetch" href="/assets/js/24.5118c903.js"><link rel="prefetch" href="/assets/js/25.d075e5d7.js"><link rel="prefetch" href="/assets/js/26.773f2460.js"><link rel="prefetch" href="/assets/js/27.d0e0d308.js"><link rel="prefetch" href="/assets/js/28.bba4c1c3.js"><link rel="prefetch" href="/assets/js/29.0d309c43.js"><link rel="prefetch" href="/assets/js/3.df8ab865.js"><link rel="prefetch" href="/assets/js/30.238bac85.js"><link rel="prefetch" href="/assets/js/31.abd71d38.js"><link rel="prefetch" href="/assets/js/32.126829f0.js"><link rel="prefetch" href="/assets/js/33.b7210392.js"><link rel="prefetch" href="/assets/js/34.808d7f11.js"><link rel="prefetch" href="/assets/js/35.92cc0670.js"><link rel="prefetch" href="/assets/js/36.525eca62.js"><link rel="prefetch" href="/assets/js/37.085ca99e.js"><link rel="prefetch" href="/assets/js/38.bd6ba530.js"><link rel="prefetch" href="/assets/js/39.bdcf0246.js"><link rel="prefetch" href="/assets/js/4.03a382ed.js"><link rel="prefetch" href="/assets/js/40.5e383ac6.js"><link rel="prefetch" href="/assets/js/41.fb3d104e.js"><link rel="prefetch" href="/assets/js/42.d3be59ab.js"><link rel="prefetch" href="/assets/js/43.861403a7.js"><link rel="prefetch" href="/assets/js/44.64ea788c.js"><link rel="prefetch" href="/assets/js/45.586e01c2.js"><link rel="prefetch" href="/assets/js/47.c1dba008.js"><link rel="prefetch" href="/assets/js/48.da57593b.js"><link rel="prefetch" href="/assets/js/49.8e699822.js"><link rel="prefetch" href="/assets/js/5.21b79be3.js"><link rel="prefetch" href="/assets/js/50.697ac881.js"><link rel="prefetch" href="/assets/js/51.6c32c16e.js"><link rel="prefetch" href="/assets/js/52.d137da31.js"><link rel="prefetch" href="/assets/js/53.22caaa9a.js"><link rel="prefetch" href="/assets/js/54.7f1d1532.js"><link rel="prefetch" href="/assets/js/55.40dbbf5b.js"><link rel="prefetch" href="/assets/js/56.04c24edc.js"><link rel="prefetch" href="/assets/js/57.b15918db.js"><link rel="prefetch" href="/assets/js/58.b3eb784b.js"><link rel="prefetch" href="/assets/js/59.0d462dd8.js"><link rel="prefetch" href="/assets/js/6.64edd77a.js"><link rel="prefetch" href="/assets/js/60.ae65015b.js"><link rel="prefetch" href="/assets/js/61.9b15da8f.js"><link rel="prefetch" href="/assets/js/62.ca728b66.js"><link rel="prefetch" href="/assets/js/63.312b3bdd.js"><link rel="prefetch" href="/assets/js/64.56be4886.js"><link rel="prefetch" href="/assets/js/65.dff3c3a3.js"><link rel="prefetch" href="/assets/js/66.95dfff51.js"><link rel="prefetch" href="/assets/js/67.17e7a9be.js"><link rel="prefetch" href="/assets/js/68.e3b5c05a.js"><link rel="prefetch" href="/assets/js/69.9ab8c7f8.js"><link rel="prefetch" href="/assets/js/7.4a3ae97d.js"><link rel="prefetch" href="/assets/js/70.8d72690b.js"><link rel="prefetch" href="/assets/js/71.3c25cf04.js"><link rel="prefetch" href="/assets/js/72.02b02d8d.js"><link rel="prefetch" href="/assets/js/73.2a8d2681.js"><link rel="prefetch" href="/assets/js/74.c577aba5.js"><link rel="prefetch" href="/assets/js/75.7d2617b0.js"><link rel="prefetch" href="/assets/js/76.97ad371e.js"><link rel="prefetch" href="/assets/js/77.4495b015.js"><link rel="prefetch" href="/assets/js/78.c7510b35.js"><link rel="prefetch" href="/assets/js/79.dc2b4ca2.js"><link rel="prefetch" href="/assets/js/8.fc1e2b26.js"><link rel="prefetch" href="/assets/js/80.454a982e.js"><link rel="prefetch" href="/assets/js/81.eba66eb5.js"><link rel="prefetch" href="/assets/js/82.1f34b986.js"><link rel="prefetch" href="/assets/js/83.a15e7917.js"><link rel="prefetch" href="/assets/js/84.212c8551.js"><link rel="prefetch" href="/assets/js/85.c077f397.js"><link rel="prefetch" href="/assets/js/86.70192242.js"><link rel="prefetch" href="/assets/js/87.e53f7254.js"><link rel="prefetch" href="/assets/js/88.d2f28869.js"><link rel="prefetch" href="/assets/js/89.9b4c13ce.js"><link rel="prefetch" href="/assets/js/9.a7fc3cc9.js"><link rel="prefetch" href="/assets/js/90.af82565a.js"><link rel="prefetch" href="/assets/js/91.153dc863.js"><link rel="prefetch" href="/assets/js/92.ea32e690.js"><link rel="prefetch" href="/assets/js/93.4c656124.js"><link rel="prefetch" href="/assets/js/94.b2283b24.js"><link rel="prefetch" href="/assets/js/95.4ad17bba.js"><link rel="prefetch" href="/assets/js/96.4c0c4821.js"><link rel="prefetch" href="/assets/js/97.14f25834.js"><link rel="prefetch" href="/assets/js/98.92c9fd2d.js"><link rel="prefetch" href="/assets/js/99.ef340791.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fefea12e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hadoop中文网</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://hadoop.apache.org/releases.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  下载安装
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="参考文档" class="dropdown-title"><span class="title">参考文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">通用</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">公共</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">HDFS</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">MapReduce</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">MapReduce REST APIs</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">YARN REST APIs</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">YARN Service</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">Submarine</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">Hadoop兼容文件系统</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">Auth</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">参考</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">配置</a></li></ul></div></div><div class="nav-item"><a href="/docs/awesome/" class="nav-link">资源教程</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言支持" class="dropdown-title"><span class="title">语言支持</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/ch.html" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/language/en.html" class="nav-link">English</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://hadoop.apache.org/releases.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  下载安装
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="参考文档" class="dropdown-title"><span class="title">参考文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">通用</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">公共</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">HDFS</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">MapReduce</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">MapReduce REST APIs</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">YARN REST APIs</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">YARN Service</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">Submarine</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">Hadoop兼容文件系统</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">Auth</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">参考</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-project-dist/hadoop-common/.html" class="nav-link">配置</a></li></ul></div></div><div class="nav-item"><a href="/docs/awesome/" class="nav-link">资源教程</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言支持" class="dropdown-title"><span class="title">语言支持</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/ch.html" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/language/en.html" class="nav-link">English</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Hadoop in Secure Mode</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/hadoop-project-dist/hadoop-common/SecureMode.html#introduction" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/hadoop-project-dist/hadoop-common/SecureMode.html#authentication" class="sidebar-link">Authentication</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/hadoop-project-dist/hadoop-common/SecureMode.html#end-user-accounts" class="sidebar-link">End User Accounts</a></li><li class="sidebar-sub-header"><a href="/docs/hadoop-project-dist/hadoop-common/SecureMode.html#user-accounts-for-hadoop-daemons" class="sidebar-link">User Accounts for Hadoop Daemons</a></li><li class="sidebar-sub-header"><a href="/docs/hadoop-project-dist/hadoop-common/SecureMode.html#kerberos-principals-for-hadoop-daemons" class="sidebar-link">Kerberos principals for Hadoop Daemons</a></li><li class="sidebar-sub-header"><a href="/docs/hadoop-project-dist/hadoop-common/SecureMode.html#mapping-from-kerberos-principals-to-os-user-accounts" class="sidebar-link">Mapping from Kerberos principals to OS user accounts</a></li><li class="sidebar-sub-header"><a href="/docs/hadoop-project-dist/hadoop-common/SecureMode.html#usage" class="sidebar-link">Usage</a></li><li class="sidebar-sub-header"><a href="/docs/hadoop-project-dist/hadoop-common/SecureMode.html#example" class="sidebar-link">Example</a></li></ul></li><li><a href="/docs/hadoop-project-dist/hadoop-common/SecureMode.html#references" class="sidebar-link">References</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hadoop-in-secure-mode"><a href="#hadoop-in-secure-mode" class="header-anchor">#</a> Hadoop in Secure Mode</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>This document describes how to configure authentication for Hadoop in secure mode. When Hadoop is configured to run in secure mode, each Hadoop service and each user must be authenticated by Kerberos.</p> <p>Forward and reverse host lookup for all service hosts must be configured correctly to allow services to authenticate with each other. Host lookups may be configured using either DNS or /etc/hosts files. Working knowledge of Kerberos and DNS is recommended before attempting to configure Hadoop services in Secure Mode.</p> <p>Security features of Hadoop consist of Authentication, <a href="/docs/hadoop-project-dist/hadoop-common/ServiceLevelAuth.html">Service Level Authorization</a>, <a href="/docs/hadoop-project-dist/hadoop-common/HttpAuthentication.html">Authentication for Web Consoles</a> and Data Confidentiality.</p> <h2 id="authentication"><a href="#authentication" class="header-anchor">#</a> Authentication</h2> <h3 id="end-user-accounts"><a href="#end-user-accounts" class="header-anchor">#</a> End User Accounts</h3> <p>When service level authentication is turned on, end users must authenticate themselves before interacting with Hadoop services. The simplest way is for a user to authenticate interactively using the <a href="http://web.mit.edu/kerberos/krb5-1.12/doc/user/user_commands/kinit.html" title="MIT Kerberos Documentation of kinit" target="_blank" rel="noopener noreferrer">Kerberos kinit command<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Programmatic authentication using Kerberos keytab files may be used when interactive login with kinit is infeasible.</p> <h3 id="user-accounts-for-hadoop-daemons"><a href="#user-accounts-for-hadoop-daemons" class="header-anchor">#</a> User Accounts for Hadoop Daemons</h3> <p>Ensure that HDFS and YARN daemons run as different Unix users, e.g. hdfs and yarn. Also, ensure that the MapReduce JobHistory server runs as different user such as mapred.</p> <p>It’s recommended to have them share a Unix group, e.g. hadoop. See also “Mapping from user to group” for group management.</p> <table><thead><tr><th>User:Group</th> <th>Daemons</th></tr></thead> <tbody><tr><td>hdfs:hadoop</td> <td>NameNode, Secondary NameNode, JournalNode, DataNode</td></tr> <tr><td>yarn:hadoop</td> <td>ResourceManager, NodeManager</td></tr> <tr><td>mapred:hadoop</td> <td>MapReduce JobHistory Server</td></tr></tbody></table> <h3 id="kerberos-principals-for-hadoop-daemons"><a href="#kerberos-principals-for-hadoop-daemons" class="header-anchor">#</a> Kerberos principals for Hadoop Daemons</h3> <p>Each Hadoop Service instance must be configured with its Kerberos principal and keytab file location.</p> <p>The general format of a Service principal is ServiceName/_HOST@REALM.TLD. e.g. dn/_HOST@EXAMPLE.COM.</p> <p>Hadoop simplifies the deployment of configuration files by allowing the hostname component of the service principal to be specified as the _HOST wildcard. Each service instance will substitute _HOST with its own fully qualified hostname at runtime. This allows administrators to deploy the same set of configuration files on all nodes. However, the keytab files will be different.</p> <h4 id="hdfs"><a href="#hdfs" class="header-anchor">#</a> HDFS</h4> <p>The NameNode keytab file, on each NameNode host, should look like the following:</p> <pre><code>$ klist -e -k -t /etc/security/keytab/nn.service.keytab
Keytab name: FILE:/etc/security/keytab/nn.service.keytab
KVNO Timestamp         Principal
   4 07/18/11 21:08:09 nn/full.qualified.domain.name@REALM.TLD (AES-256 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 nn/full.qualified.domain.name@REALM.TLD (AES-128 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 nn/full.qualified.domain.name@REALM.TLD (ArcFour with HMAC/md5)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (AES-256 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (AES-128 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (ArcFour with HMAC/md5)
</code></pre> <p>The Secondary NameNode keytab file, on that host, should look like the following:</p> <pre><code>$ klist -e -k -t /etc/security/keytab/sn.service.keytab
Keytab name: FILE:/etc/security/keytab/sn.service.keytab
KVNO Timestamp         Principal
   4 07/18/11 21:08:09 sn/full.qualified.domain.name@REALM.TLD (AES-256 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 sn/full.qualified.domain.name@REALM.TLD (AES-128 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 sn/full.qualified.domain.name@REALM.TLD (ArcFour with HMAC/md5)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (AES-256 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (AES-128 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (ArcFour with HMAC/md5)
</code></pre> <p>The DataNode keytab file, on each host, should look like the following:</p> <pre><code>$ klist -e -k -t /etc/security/keytab/dn.service.keytab
Keytab name: FILE:/etc/security/keytab/dn.service.keytab
KVNO Timestamp         Principal
   4 07/18/11 21:08:09 dn/full.qualified.domain.name@REALM.TLD (AES-256 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 dn/full.qualified.domain.name@REALM.TLD (AES-128 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 dn/full.qualified.domain.name@REALM.TLD (ArcFour with HMAC/md5)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (AES-256 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (AES-128 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (ArcFour with HMAC/md5)
</code></pre> <h4 id="yarn"><a href="#yarn" class="header-anchor">#</a> YARN</h4> <p>The ResourceManager keytab file, on the ResourceManager host, should look like the following:</p> <pre><code>$ klist -e -k -t /etc/security/keytab/rm.service.keytab
Keytab name: FILE:/etc/security/keytab/rm.service.keytab
KVNO Timestamp         Principal
   4 07/18/11 21:08:09 rm/full.qualified.domain.name@REALM.TLD (AES-256 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 rm/full.qualified.domain.name@REALM.TLD (AES-128 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 rm/full.qualified.domain.name@REALM.TLD (ArcFour with HMAC/md5)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (AES-256 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (AES-128 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (ArcFour with HMAC/md5)
</code></pre> <p>The NodeManager keytab file, on each host, should look like the following:</p> <pre><code>$ klist -e -k -t /etc/security/keytab/nm.service.keytab
Keytab name: FILE:/etc/security/keytab/nm.service.keytab
KVNO Timestamp         Principal
   4 07/18/11 21:08:09 nm/full.qualified.domain.name@REALM.TLD (AES-256 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 nm/full.qualified.domain.name@REALM.TLD (AES-128 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 nm/full.qualified.domain.name@REALM.TLD (ArcFour with HMAC/md5)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (AES-256 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (AES-128 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (ArcFour with HMAC/md5)
</code></pre> <h4 id="mapreduce-jobhistory-server"><a href="#mapreduce-jobhistory-server" class="header-anchor">#</a> MapReduce JobHistory Server</h4> <p>The MapReduce JobHistory Server keytab file, on that host, should look like the following:</p> <pre><code>$ klist -e -k -t /etc/security/keytab/jhs.service.keytab
Keytab name: FILE:/etc/security/keytab/jhs.service.keytab
KVNO Timestamp         Principal
   4 07/18/11 21:08:09 jhs/full.qualified.domain.name@REALM.TLD (AES-256 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 jhs/full.qualified.domain.name@REALM.TLD (AES-128 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 jhs/full.qualified.domain.name@REALM.TLD (ArcFour with HMAC/md5)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (AES-256 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (AES-128 CTS mode with 96-bit SHA-1 HMAC)
   4 07/18/11 21:08:09 host/full.qualified.domain.name@REALM.TLD (ArcFour with HMAC/md5)
</code></pre> <h3 id="mapping-from-kerberos-principals-to-os-user-accounts"><a href="#mapping-from-kerberos-principals-to-os-user-accounts" class="header-anchor">#</a> Mapping from Kerberos principals to OS user accounts</h3> <p>Hadoop maps Kerberos principals to OS user (system) accounts using rules specified by hadoop.security.auth_to_local. How Hadoop evaluates these rules is determined by the setting of hadoop.security.auth_to_local.mechanism.</p> <p>In the default hadoop mode a Kerberos principal must be matched against a rule that transforms the principal to a simple form, i.e. a user account name without ‘@’ or ‘/’, otherwise a principal will not be authorized and a error will be logged. In case of the MIT mode the rules work in the same way as the auth_to_local in <a href="http://web.mit.edu/Kerberos/krb5-latest/doc/admin/conf_files/krb5_conf.html" target="_blank" rel="noopener noreferrer">Kerberos configuration file (krb5.conf)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and the restrictions of hadoop mode do not apply. If you use MIT mode it is suggested to use the same auth_to_local rules that are specified in your /etc/krb5.conf as part of your default realm and keep them in sync. In both hadoop and MIT mode the rules are being applied (with the exception of DEFAULT) to all principals regardless of their specified realm. Also, note you should not rely on the auth_to_local rules as an ACL and use proper (OS) mechanisms.</p> <p>Possible values for auth_to_local are:</p> <h3 id="usage"><a href="#usage" class="header-anchor">#</a> Usage</h3> <pre><code>KDiag: Diagnose Kerberos Problems
  [-D key=value] : Define a configuration option.
  [--jaas] : Require a JAAS file to be defined in java.security.auth.login.config.
  [--keylen &lt;keylen&gt;] : Require a minimum size for encryption keys supported by the JVM. Default value : 256.
  [--keytab &lt;keytab&gt; --principal &lt;principal&gt;] : Login from a keytab as a specific principal.
  [--nofail] : Do not fail on the first problem.
  [--nologin] : Do not attempt to log in.
  [--out &lt;file&gt;] : Write output to a file.
  [--resource &lt;resource&gt;] : Load an XML configuration resource.
  [--secure] : Require the hadoop configuration to be secure.
  [--verifyshortname &lt;principal&gt;]: Verify the short name of the specific principal does not contain '@' or '/'
</code></pre> <h4 id="jaas-require-a-jaas-file-to-be-defined-in-java-security-auth-login-config"><a href="#jaas-require-a-jaas-file-to-be-defined-in-java-security-auth-login-config" class="header-anchor">#</a> --jaas: Require a JAAS file to be defined in java.security.auth.login.config.</h4> <p>If --jaas is set, the Java system property java.security.auth.login.config must be set to a JAAS file; this file must exist, be a simple file of non-zero bytes, and readable by the current user. More detailed validation is not performed.</p> <p>JAAS files are not needed by Hadoop itself, but some services (such as Zookeeper) do require them for secure operation.</p> <h4 id="keylen-require-a-minimum-size-for-encryption-keys-supported-by-the-jvm"><a href="#keylen-require-a-minimum-size-for-encryption-keys-supported-by-the-jvm" class="header-anchor">#</a> --keylen <length>: Require a minimum size for encryption keys supported by the JVM&quot;.</length></h4> <p>If the JVM does not support this length, the command will fail.</p> <p>The default value is to 256, as needed for the AES256 encryption scheme. A JVM without the Java Cryptography Extensions installed does not support such a key length. Kerberos will not work unless configured to use an encryption scheme with a shorter key length.</p> <h4 id="keytab-principal-log-in-from-a-keytab"><a href="#keytab-principal-log-in-from-a-keytab" class="header-anchor">#</a> --keytab <keytab> --principal <principal>: Log in from a keytab.</principal></keytab></h4> <p>Log in from a keytab as the specific principal.</p> <ol><li>The file must contain the specific principal, including any named host. That is, there is no mapping from _HOST to the current hostname.</li> <li>KDiag will log out and attempt to log back in again. This catches JVM compatibility problems which have existed in the past. (Hadoop’s Kerberos support requires use of/introspection into JVM-specific classes).</li></ol> <h4 id="nofail-do-not-fail-on-the-first-problem"><a href="#nofail-do-not-fail-on-the-first-problem" class="header-anchor">#</a> --nofail : Do not fail on the first problem</h4> <p>KDiag will make a best-effort attempt to diagnose all Kerberos problems, rather than stop at the first one.</p> <p>This is somewhat limited; checks are made in the order which problems surface (e.g keylength is checked first), so an early failure can trigger many more problems. But it does produce a more detailed report.</p> <h4 id="nologin-do-not-attempt-to-log-in"><a href="#nologin-do-not-attempt-to-log-in" class="header-anchor">#</a> --nologin: Do not attempt to log in.</h4> <p>Skip trying to log in. This takes precedence over the --keytab option, and also disables trying to log in to kerberos as the current kinited user.</p> <p>This is useful when the KDiag command is being invoked within an application, as it does not set up Hadoop’s static security state —merely check for some basic Kerberos preconditions.</p> <h4 id="out-outfile-write-output-to-file"><a href="#out-outfile-write-output-to-file" class="header-anchor">#</a> --out outfile: Write output to file.</h4> <pre><code>hadoop kdiag --out out.txt
</code></pre> <p>Much of the diagnostics information comes from the JRE (to stderr) and from Log4j (to stdout). To get all the output, it is best to redirect both these output streams to the same file, and omit the --out option.</p> <pre><code>hadoop kdiag --keytab zk.service.keytab --principal zookeeper/devix.example.org@REALM &gt; out.txt 2&gt;&amp;1
</code></pre> <p>Even there, the output of the two streams, emitted across multiple threads, can be a bit confusing. It will get easier with practise. Looking at the thread name in the Log4j output to distinguish background threads from the main thread helps at the hadoop level, but doesn’t assist in JVM-level logging.</p> <h4 id="resource-xml-configuration-resource-to-load"><a href="#resource-xml-configuration-resource-to-load" class="header-anchor">#</a> --resource <resource> : XML configuration resource to load.</resource></h4> <p>To load XML configuration files, this option can be used. As by default, the core-default and core-site XML resources are only loaded. This will help, when additional configuration files has any Kerberos related configurations.</p> <pre><code>hadoop kdiag --resource hbase-default.xml --resource hbase-site.xml
</code></pre> <p>For extra logging during the operation, set the logging and HADOOP_JAAS_DEBUG environment variable to the values listed in “Troubleshooting”. The JVM options are automatically set in KDiag.</p> <h4 id="secure-fail-if-the-command-is-not-executed-on-a-secure-cluster"><a href="#secure-fail-if-the-command-is-not-executed-on-a-secure-cluster" class="header-anchor">#</a> --secure: Fail if the command is not executed on a secure cluster.</h4> <p>That is: if the authentication mechanism of the cluster is explicitly or implicitly set to “simple”:</p> <pre><code>&lt;property&gt;
  &lt;name&gt;hadoop.security.authentication&lt;/name&gt;
  &lt;value&gt;simple&lt;/value&gt;
&lt;/property&gt;
</code></pre> <p>Needless to say, an application so configured cannot talk to a secure Hadoop cluster.</p> <h4 id="verifyshortname-validate-the-short-name-of-a-principal"><a href="#verifyshortname-validate-the-short-name-of-a-principal" class="header-anchor">#</a> --verifyshortname <principal>: validate the short name of a principal</principal></h4> <p>This verifies that the short name of a principal contains neither the &quot;@&quot; nor &quot;/&quot; characters.</p> <h3 id="example"><a href="#example" class="header-anchor">#</a> Example</h3> <pre><code>hadoop kdiag \
  --nofail \
  --resource hdfs-site.xml --resource yarn-site.xml \
  --keylen 1024 \
  --keytab zk.service.keytab --principal zookeeper/devix.example.org@REALM
</code></pre> <p>This attempts to to perform all diagnostics without failing early, load in the HDFS and YARN XML resources, require a minimum key length of 1024 bytes, and log in as the principal zookeeper/devix.example.org@REALM, whose key must be in the keytab zk.service.keytab</p> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <ol><li>O’Malley O et al. <a href="https://issues.apache.org/jira/secure/attachment/12428537/security-design.pdf" target="_blank" rel="noopener noreferrer">Hadoop Security Design<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>O’Malley O, <a href="http://www.slideshare.net/oom65/hadoop-security-architecture" target="_blank" rel="noopener noreferrer">Hadoop Security Architecture<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/jgss/tutorials/Troubleshooting.html" target="_blank" rel="noopener noreferrer">Troubleshooting Kerberos on Java 7<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jgss/tutorials/Troubleshooting.html" target="_blank" rel="noopener noreferrer">Troubleshooting Kerberos on Java 8<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/jgss/tutorials/Troubleshooting.html" target="_blank" rel="noopener noreferrer">Java 7 Kerberos Requirements<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jgss/tutorials/Troubleshooting.html" target="_blank" rel="noopener noreferrer">Java 8 Kerberos Requirements<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Loughran S., <a href="https://steveloughran.gitbooks.io/kerberos_and_hadoop/content/" target="_blank" rel="noopener noreferrer">Hadoop and Kerberos: The Madness beyond the Gate<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.03e63b66.js" defer></script><script src="/assets/js/2.fd33e103.js" defer></script><script src="/assets/js/46.4e18b7fe.js" defer></script>
  </body>
</html>
