<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using GPU On YARN | Hadoop中文网</title>
    <meta name="description" content="Hadoop官方文档中文社区">
    <link rel="icon" href="/hadoop.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.fefea12e.css" as="style"><link rel="preload" href="/assets/js/app.03e63b66.js" as="script"><link rel="preload" href="/assets/js/2.fd33e103.js" as="script"><link rel="preload" href="/assets/js/114.97ce2cfb.js" as="script"><link rel="prefetch" href="/assets/js/10.0dbc29ee.js"><link rel="prefetch" href="/assets/js/100.51e7458e.js"><link rel="prefetch" href="/assets/js/101.cab336f3.js"><link rel="prefetch" href="/assets/js/102.d7e40b1a.js"><link rel="prefetch" href="/assets/js/103.3cd23502.js"><link rel="prefetch" href="/assets/js/104.a263cbd3.js"><link rel="prefetch" href="/assets/js/105.1cf856b7.js"><link rel="prefetch" href="/assets/js/106.1bd66c2f.js"><link rel="prefetch" href="/assets/js/107.7acc52af.js"><link rel="prefetch" href="/assets/js/108.096bf626.js"><link rel="prefetch" href="/assets/js/109.91d5ec0d.js"><link rel="prefetch" href="/assets/js/11.84130fe4.js"><link rel="prefetch" href="/assets/js/110.602bc28b.js"><link rel="prefetch" href="/assets/js/111.490d917f.js"><link rel="prefetch" href="/assets/js/112.dcdb6f77.js"><link rel="prefetch" href="/assets/js/113.0a64a78e.js"><link rel="prefetch" href="/assets/js/115.719819cf.js"><link rel="prefetch" href="/assets/js/116.606be43b.js"><link rel="prefetch" href="/assets/js/117.5f1db751.js"><link rel="prefetch" href="/assets/js/118.4c8b3331.js"><link rel="prefetch" href="/assets/js/119.756df93e.js"><link rel="prefetch" href="/assets/js/12.a85df2ad.js"><link rel="prefetch" href="/assets/js/120.21755a3d.js"><link rel="prefetch" href="/assets/js/121.86335dec.js"><link rel="prefetch" href="/assets/js/122.68c84b42.js"><link rel="prefetch" href="/assets/js/123.26f2d157.js"><link rel="prefetch" href="/assets/js/124.b8bb5eac.js"><link rel="prefetch" href="/assets/js/125.d3748b6f.js"><link rel="prefetch" href="/assets/js/126.74a59909.js"><link rel="prefetch" href="/assets/js/127.e75ea051.js"><link rel="prefetch" href="/assets/js/128.86691d41.js"><link rel="prefetch" href="/assets/js/129.1b73844b.js"><link rel="prefetch" href="/assets/js/13.5cc92b07.js"><link rel="prefetch" href="/assets/js/14.23af424b.js"><link rel="prefetch" href="/assets/js/15.d44d7e96.js"><link rel="prefetch" href="/assets/js/16.9433ad8d.js"><link rel="prefetch" href="/assets/js/17.e88b2671.js"><link rel="prefetch" href="/assets/js/18.621a61a9.js"><link rel="prefetch" href="/assets/js/19.c2269943.js"><link rel="prefetch" href="/assets/js/20.97a13073.js"><link rel="prefetch" href="/assets/js/21.cfddb2e0.js"><link rel="prefetch" href="/assets/js/22.3fc2e173.js"><link rel="prefetch" href="/assets/js/23.b44f9aaa.js"><link rel="prefetch" href="/assets/js/24.5118c903.js"><link rel="prefetch" href="/assets/js/25.d075e5d7.js"><link rel="prefetch" href="/assets/js/26.773f2460.js"><link rel="prefetch" href="/assets/js/27.d0e0d308.js"><link rel="prefetch" href="/assets/js/28.bba4c1c3.js"><link rel="prefetch" href="/assets/js/29.0d309c43.js"><link rel="prefetch" href="/assets/js/3.df8ab865.js"><link rel="prefetch" href="/assets/js/30.238bac85.js"><link rel="prefetch" href="/assets/js/31.abd71d38.js"><link rel="prefetch" href="/assets/js/32.126829f0.js"><link rel="prefetch" href="/assets/js/33.b7210392.js"><link rel="prefetch" href="/assets/js/34.808d7f11.js"><link rel="prefetch" href="/assets/js/35.92cc0670.js"><link rel="prefetch" href="/assets/js/36.525eca62.js"><link rel="prefetch" href="/assets/js/37.085ca99e.js"><link rel="prefetch" href="/assets/js/38.bd6ba530.js"><link rel="prefetch" href="/assets/js/39.bdcf0246.js"><link rel="prefetch" href="/assets/js/4.03a382ed.js"><link rel="prefetch" href="/assets/js/40.5e383ac6.js"><link rel="prefetch" href="/assets/js/41.fb3d104e.js"><link rel="prefetch" href="/assets/js/42.d3be59ab.js"><link rel="prefetch" href="/assets/js/43.861403a7.js"><link rel="prefetch" href="/assets/js/44.64ea788c.js"><link rel="prefetch" href="/assets/js/45.586e01c2.js"><link rel="prefetch" href="/assets/js/46.4e18b7fe.js"><link rel="prefetch" href="/assets/js/47.c1dba008.js"><link rel="prefetch" href="/assets/js/48.da57593b.js"><link rel="prefetch" href="/assets/js/49.8e699822.js"><link rel="prefetch" href="/assets/js/5.21b79be3.js"><link rel="prefetch" href="/assets/js/50.697ac881.js"><link rel="prefetch" href="/assets/js/51.6c32c16e.js"><link rel="prefetch" href="/assets/js/52.d137da31.js"><link rel="prefetch" href="/assets/js/53.22caaa9a.js"><link rel="prefetch" href="/assets/js/54.7f1d1532.js"><link rel="prefetch" href="/assets/js/55.40dbbf5b.js"><link rel="prefetch" href="/assets/js/56.04c24edc.js"><link rel="prefetch" href="/assets/js/57.b15918db.js"><link rel="prefetch" href="/assets/js/58.b3eb784b.js"><link rel="prefetch" href="/assets/js/59.0d462dd8.js"><link rel="prefetch" href="/assets/js/6.64edd77a.js"><link rel="prefetch" href="/assets/js/60.ae65015b.js"><link rel="prefetch" href="/assets/js/61.9b15da8f.js"><link rel="prefetch" href="/assets/js/62.ca728b66.js"><link rel="prefetch" href="/assets/js/63.312b3bdd.js"><link rel="prefetch" href="/assets/js/64.56be4886.js"><link rel="prefetch" href="/assets/js/65.dff3c3a3.js"><link rel="prefetch" href="/assets/js/66.95dfff51.js"><link rel="prefetch" href="/assets/js/67.17e7a9be.js"><link rel="prefetch" href="/assets/js/68.e3b5c05a.js"><link rel="prefetch" href="/assets/js/69.9ab8c7f8.js"><link rel="prefetch" href="/assets/js/7.4a3ae97d.js"><link rel="prefetch" href="/assets/js/70.8d72690b.js"><link rel="prefetch" href="/assets/js/71.3c25cf04.js"><link rel="prefetch" href="/assets/js/72.02b02d8d.js"><link rel="prefetch" href="/assets/js/73.2a8d2681.js"><link rel="prefetch" href="/assets/js/74.c577aba5.js"><link rel="prefetch" href="/assets/js/75.7d2617b0.js"><link rel="prefetch" href="/assets/js/76.97ad371e.js"><link rel="prefetch" href="/assets/js/77.4495b015.js"><link rel="prefetch" href="/assets/js/78.c7510b35.js"><link rel="prefetch" href="/assets/js/79.dc2b4ca2.js"><link rel="prefetch" href="/assets/js/8.fc1e2b26.js"><link rel="prefetch" href="/assets/js/80.454a982e.js"><link rel="prefetch" href="/assets/js/81.eba66eb5.js"><link rel="prefetch" href="/assets/js/82.1f34b986.js"><link rel="prefetch" href="/assets/js/83.a15e7917.js"><link rel="prefetch" href="/assets/js/84.212c8551.js"><link rel="prefetch" href="/assets/js/85.c077f397.js"><link rel="prefetch" href="/assets/js/86.70192242.js"><link rel="prefetch" href="/assets/js/87.e53f7254.js"><link rel="prefetch" href="/assets/js/88.d2f28869.js"><link rel="prefetch" href="/assets/js/89.9b4c13ce.js"><link rel="prefetch" href="/assets/js/9.a7fc3cc9.js"><link rel="prefetch" href="/assets/js/90.af82565a.js"><link rel="prefetch" href="/assets/js/91.153dc863.js"><link rel="prefetch" href="/assets/js/92.ea32e690.js"><link rel="prefetch" href="/assets/js/93.4c656124.js"><link rel="prefetch" href="/assets/js/94.b2283b24.js"><link rel="prefetch" href="/assets/js/95.4ad17bba.js"><link rel="prefetch" href="/assets/js/96.4c0c4821.js"><link rel="prefetch" href="/assets/js/97.14f25834.js"><link rel="prefetch" href="/assets/js/98.92c9fd2d.js"><link rel="prefetch" href="/assets/js/99.ef340791.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fefea12e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hadoop中文网</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://hadoop.apache.org/releases.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  下载安装
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="参考文档" class="dropdown-title"><span class="title">参考文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">通用</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">公共</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">HDFS</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">MapReduce</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">MapReduce REST APIs</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">YARN REST APIs</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">YARN Service</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">Submarine</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">Hadoop兼容文件系统</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">Auth</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">参考</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">配置</a></li></ul></div></div><div class="nav-item"><a href="/docs/awesome/" class="nav-link">资源教程</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言支持" class="dropdown-title"><span class="title">语言支持</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/ch.html" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/language/en.html" class="nav-link">English</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://hadoop.apache.org/releases.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  下载安装
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="参考文档" class="dropdown-title"><span class="title">参考文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">通用</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">公共</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">HDFS</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">MapReduce</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">MapReduce REST APIs</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">YARN REST APIs</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">YARN Service</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">Submarine</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">Hadoop兼容文件系统</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">Auth</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">参考</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">配置</a></li></ul></div></div><div class="nav-item"><a href="/docs/awesome/" class="nav-link">资源教程</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言支持" class="dropdown-title"><span class="title">语言支持</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/ch.html" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/language/en.html" class="nav-link">English</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Using GPU On YARN</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/hadoop-yarn/hadoop-yarn-site/UsingGpus.html#gpu-scheduling" class="sidebar-link">GPU scheduling</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/hadoop-yarn/hadoop-yarn-site/UsingGpus.html#gpu-isolation" class="sidebar-link">GPU Isolation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/hadoop-yarn/hadoop-yarn-site/UsingGpus.html#in-yarn-site-xml" class="sidebar-link">In yarn-site.xml</a></li><li class="sidebar-sub-header"><a href="/docs/hadoop-yarn/hadoop-yarn-site/UsingGpus.html#in-container-executor-cfg" class="sidebar-link">In container-executor.cfg</a></li></ul></li><li><a href="/docs/hadoop-yarn/hadoop-yarn-site/UsingGpus.html#distributed-shell-gpu" class="sidebar-link">Distributed-shell + GPU</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/hadoop-yarn/hadoop-yarn-site/UsingGpus.html#distributed-shell-gpu-without-docker" class="sidebar-link">Distributed-shell + GPU without Docker</a></li><li class="sidebar-sub-header"><a href="/docs/hadoop-yarn/hadoop-yarn-site/UsingGpus.html#distributed-shell-gpu-with-docker" class="sidebar-link">Distributed-shell + GPU with Docker</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="using-gpu-on-yarn"><a href="#using-gpu-on-yarn" class="header-anchor">#</a> Using GPU On YARN</h1> <h1 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h1> <ul><li>As of now, only Nvidia GPUs are supported by YARN</li> <li>YARN node managers have to be pre-installed with Nvidia drivers.</li> <li>When Docker is used as container runtime context, nvidia-docker 1.0 needs to be installed (Current supported version in YARN for nvidia-docker).</li></ul> <h1 id="configs"><a href="#configs" class="header-anchor">#</a> Configs</h1> <h2 id="gpu-scheduling"><a href="#gpu-scheduling" class="header-anchor">#</a> GPU scheduling</h2> <p>In resource-types.xml</p> <p>Add following properties</p> <pre><code>&lt;configuration&gt;
  &lt;property&gt;
     &lt;name&gt;yarn.resource-types&lt;/name&gt;
     &lt;value&gt;yarn.io/gpu&lt;/value&gt;
  &lt;/property&gt;
&lt;/configuration&gt;
</code></pre> <p>In yarn-site.xml</p> <p>DominantResourceCalculator MUST be configured to enable GPU scheduling/isolation.</p> <p>For Capacity Scheduler, use following property to configure DominantResourceCalculator (In capacity-scheduler.xml):</p> <table><thead><tr><th>Property</th> <th>Default value</th></tr></thead> <tbody><tr><td>yarn.scheduler.capacity.resource-calculator</td> <td>org.apache.hadoop.yarn.util.resource.DominantResourceCalculator</td></tr></tbody></table> <h2 id="gpu-isolation"><a href="#gpu-isolation" class="header-anchor">#</a> GPU Isolation</h2> <h3 id="in-yarn-site-xml"><a href="#in-yarn-site-xml" class="header-anchor">#</a> In yarn-site.xml</h3> <pre><code>  &lt;property&gt;
    &lt;name&gt;yarn.nodemanager.resource-plugins&lt;/name&gt;
    &lt;value&gt;yarn.io/gpu&lt;/value&gt;
  &lt;/property&gt;
</code></pre> <p>This is to enable GPU isolation module on NodeManager side.</p> <p>By default, YARN will automatically detect and config GPUs when above config is set. Following configs need to be set in yarn-site.xml only if admin has specialized requirements.</p> <ol><li>Allowed GPU Devices</li></ol> <table><thead><tr><th>Property</th> <th>Default value</th></tr></thead> <tbody><tr><td>yarn.nodemanager.resource-plugins.gpu.allowed-gpu-devices</td> <td>auto</td></tr></tbody></table> <p>Specify GPU devices which can be managed by YARN NodeManager (split by comma). Number of GPU devices will be reported to RM to make scheduling decisions. Set to auto (default) let YARN automatically discover GPU resource from system.</p> <p>Manually specify GPU devices if auto detect GPU device failed or admin only want subset of GPU devices managed by YARN. GPU device is identified by their minor device number and index. A common approach to get minor device number of GPUs is using nvidia-smi -q and search Minor Number output.</p> <p>When minor numbers are specified manually, admin needs to include indice of GPUs as well, format is index:minor_number[,index:minor_number...]. An example of manual specification is 0:0,1:1,2:2,3:4&quot;to allow YARN NodeManager to manage GPU devices with indices 0/1/2/3 and minor number 0/1/2/4. numbers .</p> <ol start="2"><li>Executable to discover GPUs</li></ol> <table><thead><tr><th>Property</th> <th>value</th></tr></thead> <tbody><tr><td>yarn.nodemanager.resource-plugins.gpu.path-to-discovery-executables</td> <td>/absolute/path/to/nvidia-smi</td></tr></tbody></table> <p>When yarn.nodemanager.resource.gpu.allowed-gpu-devices=auto specified, YARN NodeManager needs to run GPU discovery binary (now only support nvidia-smi) to get GPU-related information. When value is empty (default), YARN NodeManager will try to locate discovery executable itself. An example of the config value is: /usr/local/bin/nvidia-smi</p> <ol start="3"><li>Docker Plugin Related Configs</li></ol> <p>Following configs can be customized when user needs to run GPU applications inside Docker container. They’re not required if admin follows default installation/configuration of nvidia-docker.</p> <table><thead><tr><th>Property</th> <th>Default value</th></tr></thead> <tbody><tr><td>yarn.nodemanager.resource-plugins.gpu.docker-plugin</td> <td>nvidia-docker-v1</td></tr></tbody></table> <p>Specify docker command plugin for GPU. By default uses Nvidia docker V1.0, nvidia-docker-v2 is available for V2.x.</p> <table><thead><tr><th>Property</th> <th>Default value</th></tr></thead> <tbody><tr><td>yarn.nodemanager.resource-plugins.gpu.docker-plugin.nvidia-docker-v1.endpoint</td> <td><a href="http://localhost:3476/v1.0/docker/cli" target="_blank" rel="noopener noreferrer">http://localhost:3476/v1.0/docker/cli<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr></tbody></table> <p>Specify end point of nvidia-docker-plugin. Please find documentation: <a href="https://github.com/NVIDIA/nvidia-docker/wiki" target="_blank" rel="noopener noreferrer">https://github.com/NVIDIA/nvidia-docker/wiki<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> For more details.</p> <ol start="4"><li>CGroups mount</li></ol> <p>GPU isolation uses CGroup <a href="https://www.kernel.org/doc/Documentation/cgroup-v1/devices.txt" target="_blank" rel="noopener noreferrer">devices controller<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to do per-GPU device isolation. Following configs should be added to yarn-site.xml to automatically mount CGroup sub devices, otherwise admin has to manually create devices subfolder in order to use this feature.</p> <table><thead><tr><th>Property</th> <th>Default value</th></tr></thead> <tbody><tr><td>yarn.nodemanager.linux-container-executor.cgroups.mount</td> <td>true</td></tr></tbody></table> <h3 id="in-container-executor-cfg"><a href="#in-container-executor-cfg" class="header-anchor">#</a> In container-executor.cfg</h3> <p>In general, following config needs to be added to container-executor.cfg</p> <pre><code>[gpu]
module.enabled=true
</code></pre> <p>When user needs to run GPU applications under non-Docker environment:</p> <pre><code>[cgroups]
# This should be same as yarn.nodemanager.linux-container-executor.cgroups.mount-path inside yarn-site.xml
root=/sys/fs/cgroup
# This should be same as yarn.nodemanager.linux-container-executor.cgroups.hierarchy inside yarn-site.xml
yarn-hierarchy=yarn
</code></pre> <p>When user needs to run GPU applications under Docker environment:</p> <ol><li>Add GPU related devices to docker section:</li></ol> <p>Values separated by comma, you can get this by running ls /dev/nvidia*</p> <pre><code>[docker]
docker.allowed.devices=/dev/nvidiactl,/dev/nvidia-uvm,/dev/nvidia-uvm-tools,/dev/nvidia1,/dev/nvidia0
</code></pre> <ol start="2"><li><p>Add nvidia-docker to volume-driver whitelist.</p> <p>[docker]
...
docker.allowed.volume-drivers</p></li> <li><p>Add nvidia_driver_<version> to readonly mounts whitelist.</version></p> <p>[docker]
...
docker.allowed.ro-mounts=nvidia_driver_375.66</p></li> <li><p>If use nvidia-docker-v2 as gpu docker plugin, add nvidia to runtimes whitelist.</p> <p>[docker]
...
docker.allowed.runtimes=nvidia</p></li></ol> <h1 id="use-it"><a href="#use-it" class="header-anchor">#</a> Use it</h1> <h2 id="distributed-shell-gpu"><a href="#distributed-shell-gpu" class="header-anchor">#</a> Distributed-shell + GPU</h2> <p>Distributed shell currently support specify additional resource types other than memory and vcores.</p> <h3 id="distributed-shell-gpu-without-docker"><a href="#distributed-shell-gpu-without-docker" class="header-anchor">#</a> Distributed-shell + GPU without Docker</h3> <p>Run distributed shell without using docker container (Asks 2 tasks, each task has 3GB memory, 1 vcore, 2 GPU device resource):</p> <pre><code>yarn jar &lt;path/to/hadoop-yarn-applications-distributedshell.jar&gt; \
  -jar &lt;path/to/hadoop-yarn-applications-distributedshell.jar&gt; \
  -shell_command /usr/local/nvidia/bin/nvidia-smi \
  -container_resources memory-mb=3072,vcores=1,yarn.io/gpu=2 \
  -num_containers 2
</code></pre> <p>You should be able to see output like</p> <pre><code>Tue Dec  5 22:21:47 2017
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 375.66                 Driver Version: 375.66                    |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|===============================+======================+======================|
|   0  Tesla P100-PCIE...  Off  | 0000:04:00.0     Off |                    0 |
| N/A   30C    P0    24W / 250W |      0MiB / 12193MiB |      0%      Default |
+-------------------------------+----------------------+----------------------+
|   1  Tesla P100-PCIE...  Off  | 0000:82:00.0     Off |                    0 |
| N/A   34C    P0    25W / 250W |      0MiB / 12193MiB |      0%      Default |
+-------------------------------+----------------------+----------------------+

+-----------------------------------------------------------------------------+
| Processes:                                                       GPU Memory |
|  GPU       PID  Type  Process name                               Usage      |
|=============================================================================|
|  No running processes found                                                 |
+-----------------------------------------------------------------------------+
</code></pre> <p>For launched container task.</p> <h3 id="distributed-shell-gpu-with-docker"><a href="#distributed-shell-gpu-with-docker" class="header-anchor">#</a> Distributed-shell + GPU with Docker</h3> <p>You can also run distributed shell with Docker container. YARN_CONTAINER_RUNTIME_TYPE/YARN_CONTAINER_RUNTIME_DOCKER_IMAGE must be specified to use docker container.</p> <pre><code>yarn jar &lt;path/to/hadoop-yarn-applications-distributedshell.jar&gt; \
       -jar &lt;path/to/hadoop-yarn-applications-distributedshell.jar&gt; \
       -shell_env YARN_CONTAINER_RUNTIME_TYPE=docker \
       -shell_env YARN_CONTAINER_RUNTIME_DOCKER_IMAGE=&lt;docker-image-name&gt; \
       -shell_command nvidia-smi \
       -container_resources memory-mb=3072,vcores=1,yarn.io/gpu=2 \
       -num_containers 2
</code></pre></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.03e63b66.js" defer></script><script src="/assets/js/2.fd33e103.js" defer></script><script src="/assets/js/114.97ce2cfb.js" defer></script>
  </body>
</html>
