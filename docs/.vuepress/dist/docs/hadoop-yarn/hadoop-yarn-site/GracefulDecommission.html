<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Graceful Decommission of YARN Nodes | Hadoop中文网</title>
    <meta name="description" content="Hadoop官方文档中文社区">
    <link rel="icon" href="/hadoop.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.fefea12e.css" as="style"><link rel="preload" href="/assets/js/app.03e63b66.js" as="script"><link rel="preload" href="/assets/js/2.fd33e103.js" as="script"><link rel="preload" href="/assets/js/96.4c0c4821.js" as="script"><link rel="prefetch" href="/assets/js/10.0dbc29ee.js"><link rel="prefetch" href="/assets/js/100.51e7458e.js"><link rel="prefetch" href="/assets/js/101.cab336f3.js"><link rel="prefetch" href="/assets/js/102.d7e40b1a.js"><link rel="prefetch" href="/assets/js/103.3cd23502.js"><link rel="prefetch" href="/assets/js/104.a263cbd3.js"><link rel="prefetch" href="/assets/js/105.1cf856b7.js"><link rel="prefetch" href="/assets/js/106.1bd66c2f.js"><link rel="prefetch" href="/assets/js/107.7acc52af.js"><link rel="prefetch" href="/assets/js/108.096bf626.js"><link rel="prefetch" href="/assets/js/109.91d5ec0d.js"><link rel="prefetch" href="/assets/js/11.84130fe4.js"><link rel="prefetch" href="/assets/js/110.602bc28b.js"><link rel="prefetch" href="/assets/js/111.490d917f.js"><link rel="prefetch" href="/assets/js/112.dcdb6f77.js"><link rel="prefetch" href="/assets/js/113.0a64a78e.js"><link rel="prefetch" href="/assets/js/114.97ce2cfb.js"><link rel="prefetch" href="/assets/js/115.719819cf.js"><link rel="prefetch" href="/assets/js/116.606be43b.js"><link rel="prefetch" href="/assets/js/117.5f1db751.js"><link rel="prefetch" href="/assets/js/118.4c8b3331.js"><link rel="prefetch" href="/assets/js/119.756df93e.js"><link rel="prefetch" href="/assets/js/12.a85df2ad.js"><link rel="prefetch" href="/assets/js/120.21755a3d.js"><link rel="prefetch" href="/assets/js/121.86335dec.js"><link rel="prefetch" href="/assets/js/122.68c84b42.js"><link rel="prefetch" href="/assets/js/123.26f2d157.js"><link rel="prefetch" href="/assets/js/124.b8bb5eac.js"><link rel="prefetch" href="/assets/js/125.d3748b6f.js"><link rel="prefetch" href="/assets/js/126.74a59909.js"><link rel="prefetch" href="/assets/js/127.e75ea051.js"><link rel="prefetch" href="/assets/js/128.86691d41.js"><link rel="prefetch" href="/assets/js/129.1b73844b.js"><link rel="prefetch" href="/assets/js/13.5cc92b07.js"><link rel="prefetch" href="/assets/js/14.23af424b.js"><link rel="prefetch" href="/assets/js/15.d44d7e96.js"><link rel="prefetch" href="/assets/js/16.9433ad8d.js"><link rel="prefetch" href="/assets/js/17.e88b2671.js"><link rel="prefetch" href="/assets/js/18.621a61a9.js"><link rel="prefetch" href="/assets/js/19.c2269943.js"><link rel="prefetch" href="/assets/js/20.97a13073.js"><link rel="prefetch" href="/assets/js/21.cfddb2e0.js"><link rel="prefetch" href="/assets/js/22.3fc2e173.js"><link rel="prefetch" href="/assets/js/23.b44f9aaa.js"><link rel="prefetch" href="/assets/js/24.5118c903.js"><link rel="prefetch" href="/assets/js/25.d075e5d7.js"><link rel="prefetch" href="/assets/js/26.773f2460.js"><link rel="prefetch" href="/assets/js/27.d0e0d308.js"><link rel="prefetch" href="/assets/js/28.bba4c1c3.js"><link rel="prefetch" href="/assets/js/29.0d309c43.js"><link rel="prefetch" href="/assets/js/3.df8ab865.js"><link rel="prefetch" href="/assets/js/30.238bac85.js"><link rel="prefetch" href="/assets/js/31.abd71d38.js"><link rel="prefetch" href="/assets/js/32.126829f0.js"><link rel="prefetch" href="/assets/js/33.b7210392.js"><link rel="prefetch" href="/assets/js/34.808d7f11.js"><link rel="prefetch" href="/assets/js/35.92cc0670.js"><link rel="prefetch" href="/assets/js/36.525eca62.js"><link rel="prefetch" href="/assets/js/37.085ca99e.js"><link rel="prefetch" href="/assets/js/38.bd6ba530.js"><link rel="prefetch" href="/assets/js/39.bdcf0246.js"><link rel="prefetch" href="/assets/js/4.03a382ed.js"><link rel="prefetch" href="/assets/js/40.5e383ac6.js"><link rel="prefetch" href="/assets/js/41.fb3d104e.js"><link rel="prefetch" href="/assets/js/42.d3be59ab.js"><link rel="prefetch" href="/assets/js/43.861403a7.js"><link rel="prefetch" href="/assets/js/44.64ea788c.js"><link rel="prefetch" href="/assets/js/45.586e01c2.js"><link rel="prefetch" href="/assets/js/46.4e18b7fe.js"><link rel="prefetch" href="/assets/js/47.c1dba008.js"><link rel="prefetch" href="/assets/js/48.da57593b.js"><link rel="prefetch" href="/assets/js/49.8e699822.js"><link rel="prefetch" href="/assets/js/5.21b79be3.js"><link rel="prefetch" href="/assets/js/50.697ac881.js"><link rel="prefetch" href="/assets/js/51.6c32c16e.js"><link rel="prefetch" href="/assets/js/52.d137da31.js"><link rel="prefetch" href="/assets/js/53.22caaa9a.js"><link rel="prefetch" href="/assets/js/54.7f1d1532.js"><link rel="prefetch" href="/assets/js/55.40dbbf5b.js"><link rel="prefetch" href="/assets/js/56.04c24edc.js"><link rel="prefetch" href="/assets/js/57.b15918db.js"><link rel="prefetch" href="/assets/js/58.b3eb784b.js"><link rel="prefetch" href="/assets/js/59.0d462dd8.js"><link rel="prefetch" href="/assets/js/6.64edd77a.js"><link rel="prefetch" href="/assets/js/60.ae65015b.js"><link rel="prefetch" href="/assets/js/61.9b15da8f.js"><link rel="prefetch" href="/assets/js/62.ca728b66.js"><link rel="prefetch" href="/assets/js/63.312b3bdd.js"><link rel="prefetch" href="/assets/js/64.56be4886.js"><link rel="prefetch" href="/assets/js/65.dff3c3a3.js"><link rel="prefetch" href="/assets/js/66.95dfff51.js"><link rel="prefetch" href="/assets/js/67.17e7a9be.js"><link rel="prefetch" href="/assets/js/68.e3b5c05a.js"><link rel="prefetch" href="/assets/js/69.9ab8c7f8.js"><link rel="prefetch" href="/assets/js/7.4a3ae97d.js"><link rel="prefetch" href="/assets/js/70.8d72690b.js"><link rel="prefetch" href="/assets/js/71.3c25cf04.js"><link rel="prefetch" href="/assets/js/72.02b02d8d.js"><link rel="prefetch" href="/assets/js/73.2a8d2681.js"><link rel="prefetch" href="/assets/js/74.c577aba5.js"><link rel="prefetch" href="/assets/js/75.7d2617b0.js"><link rel="prefetch" href="/assets/js/76.97ad371e.js"><link rel="prefetch" href="/assets/js/77.4495b015.js"><link rel="prefetch" href="/assets/js/78.c7510b35.js"><link rel="prefetch" href="/assets/js/79.dc2b4ca2.js"><link rel="prefetch" href="/assets/js/8.fc1e2b26.js"><link rel="prefetch" href="/assets/js/80.454a982e.js"><link rel="prefetch" href="/assets/js/81.eba66eb5.js"><link rel="prefetch" href="/assets/js/82.1f34b986.js"><link rel="prefetch" href="/assets/js/83.a15e7917.js"><link rel="prefetch" href="/assets/js/84.212c8551.js"><link rel="prefetch" href="/assets/js/85.c077f397.js"><link rel="prefetch" href="/assets/js/86.70192242.js"><link rel="prefetch" href="/assets/js/87.e53f7254.js"><link rel="prefetch" href="/assets/js/88.d2f28869.js"><link rel="prefetch" href="/assets/js/89.9b4c13ce.js"><link rel="prefetch" href="/assets/js/9.a7fc3cc9.js"><link rel="prefetch" href="/assets/js/90.af82565a.js"><link rel="prefetch" href="/assets/js/91.153dc863.js"><link rel="prefetch" href="/assets/js/92.ea32e690.js"><link rel="prefetch" href="/assets/js/93.4c656124.js"><link rel="prefetch" href="/assets/js/94.b2283b24.js"><link rel="prefetch" href="/assets/js/95.4ad17bba.js"><link rel="prefetch" href="/assets/js/97.14f25834.js"><link rel="prefetch" href="/assets/js/98.92c9fd2d.js"><link rel="prefetch" href="/assets/js/99.ef340791.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fefea12e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hadoop中文网</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://hadoop.apache.org/releases.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  下载安装
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="参考文档" class="dropdown-title"><span class="title">参考文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">通用</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">公共</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">HDFS</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">MapReduce</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">MapReduce REST APIs</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">YARN REST APIs</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">YARN Service</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">Submarine</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">Hadoop兼容文件系统</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">Auth</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">参考</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">配置</a></li></ul></div></div><div class="nav-item"><a href="/docs/awesome/" class="nav-link">资源教程</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言支持" class="dropdown-title"><span class="title">语言支持</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/ch.html" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/language/en.html" class="nav-link">English</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://hadoop.apache.org/releases.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  下载安装
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="参考文档" class="dropdown-title"><span class="title">参考文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">通用</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">公共</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">HDFS</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">MapReduce</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">MapReduce REST APIs</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">YARN REST APIs</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">YARN Service</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">Submarine</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">Hadoop兼容文件系统</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">Auth</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">工具</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">参考</a></li><li class="dropdown-item"><!----> <a href="/docs/hadoop-yarn/hadoop-yarn-site/.html" class="nav-link">配置</a></li></ul></div></div><div class="nav-item"><a href="/docs/awesome/" class="nav-link">资源教程</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言支持" class="dropdown-title"><span class="title">语言支持</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/ch.html" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/language/en.html" class="nav-link">English</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Graceful Decommission of YARN Nodes</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html#overview" class="sidebar-link">Overview</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html#quick-start" class="sidebar-link">Quick start</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html#features" class="sidebar-link">Features</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html#trigger-decommission-recommission-based-on-exclude-include-lists" class="sidebar-link">Trigger decommission/recommission based on exclude/include lists</a></li><li class="sidebar-sub-header"><a href="/docs/hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html#per-node-decommission-timeout-support" class="sidebar-link">Per-Node decommission timeout support</a></li><li class="sidebar-sub-header"><a href="/docs/hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html#client-or-server-side-timeout" class="sidebar-link">Client or server side timeout</a></li><li class="sidebar-sub-header"><a href="/docs/hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html#rmnode-handles-decommission-events" class="sidebar-link">RMNode handles decommission events</a></li><li class="sidebar-sub-header"><a href="/docs/hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html#automatic-and-asynchronous-tracking-of-decommissioning-nodes-status" class="sidebar-link">Automatic and asynchronous tracking of decommissioning nodes status</a></li></ul></li><li><a href="/docs/hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html#configuration" class="sidebar-link">Configuration</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="graceful-decommission-of-yarn-nodes"><a href="#graceful-decommission-of-yarn-nodes" class="header-anchor">#</a> Graceful Decommission of YARN Nodes</h1> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>YARN is scalable very easily: any new NodeManager could join to the configured ResourceManager and start to execute jobs. But to achieve full elasticity we need a decommissioning process which helps to remove existing nodes and down-scale the cluster.</p> <p>YARN Nodes could be decommissioned NORMAL or GRACEFUL.</p> <p>Normal Decommission of YARN Nodes means an immediate shutdown.</p> <p>Graceful Decommission of YARN Nodes is the mechanism to decommission NMs while minimize the impact to running applications. Once a node is in DECOMMISSIONING state, RM won’t schedule new containers on it and will wait for running containers and applications to complete (or until decommissioning timeout exceeded) before transition the node into DECOMMISSIONED.</p> <h2 id="quick-start"><a href="#quick-start" class="header-anchor">#</a> Quick start</h2> <p>To do a normal decommissioning:</p> <ol><li>Start a YARN cluster (with NodeManageres and ResourceManager)</li> <li>Start a yarn job (for example with yarn jar... )</li> <li>Add yarn.resourcemanager.nodes.exclude-path property to your yarn-site.xml (Note: you don’t need to restart the ResourceManager)</li> <li>Create a text file (the location is defined in the previous step) with one line which contains the name of a selected NodeManager</li> <li>Call ./bin/yarn rmadmin -refreshNodes</li> <li>Result: The nodemanager is decommissioned immediately</li></ol> <p>In the next sections we will cover some more detailed usage (for example: using graceful decommissioning with timeout).</p> <h2 id="features"><a href="#features" class="header-anchor">#</a> Features</h2> <h3 id="trigger-decommission-recommission-based-on-exclude-include-lists"><a href="#trigger-decommission-recommission-based-on-exclude-include-lists" class="header-anchor">#</a> Trigger decommission/recommission based on exclude/include lists</h3> <p>yarn rmadmin -refreshNodes [-g [timeout in seconds] -client|server] notifies NodesListManager to detect and handle include and exclude hosts changes. NodesListManager loads excluded hosts from the exclude file as specified through the yarn.resourcemanager.nodes.exclude-path configuration in yarn-site.xml. (Note: It is unnecessary to restart RM in case of changing the exclude-path as this config will be read again for every refreshNodes command)</p> <p>The format of the file could be plain text or XML depending the extension of the file. Only the XML format supports per node timout for graceful decommissioning.</p> <p>NodesListManager inspects and compares status of RMNodes in resource manager and the exclude list, and apply necessary actions based on following rules:</p> <ul><li>Recommission DECOMMISSIONED or DECOMMISSIONING nodes that are no longer excluded;</li> <li>Gracefully decommission excluded nodes that are not already in DECOMMISSIONED nor DECOMMISSIONING state;</li> <li>Immediately decommission excluded nodes that are not already in DECOMMISSIONED state if -g flag is not specified.</li></ul> <p>Accordingly, RECOMMISSION, GRACEFUL_DECOMMISSION or DECOMMISSION RMNodeEvent will be sent to the RMNode.</p> <h3 id="per-node-decommission-timeout-support"><a href="#per-node-decommission-timeout-support" class="header-anchor">#</a> Per-Node decommission timeout support</h3> <p>To support flexible graceful decommission of nodes using different timeout through single or multiple refreshNodes requests, HostsFileReader supports optional timeout value after each hostname (or ip) in the exclude host file.</p> <p>The effective decommissioning timeout to use for a particular host is based on following priorities:</p> <p>In case of server side timeout:</p> <ol><li>Use the timeout for the particular host if specified in exclude host file;</li> <li>Use the timeout in yarn rmadmin -refreshNodes -g [timeout in seconds] -server|client if specified;</li> <li>Use the default timeout specified through “yarn.resourcemanager.nodemanager-graceful-decommission-timeout-secs” configuration.</li></ol> <p>In case of client side timout (see bellow):</p> <ol><li>Only the command line parameter defined by the -g flag will be used.</li></ol> <p>NodesListManager decides the effective timeout to use and set it on individual RMNode. The timeout could also be dynamically adjusted through yarn rmadmin -refreshNodes -g [timeout in seconds] command. NodesListManager will resolve the effective timeout to use and update RMNode as necessary of the new timeout. Change of timeout does not reset the ongoing decommissioning but only affect the evaluation of whether the node has reached decommissioning timeout.</p> <p>Here is a sample excludes file in xml format.</p> <pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;hosts&gt;
  &lt;host&gt;&lt;name&gt;host1&lt;/name&gt;&lt;/host&gt;
  &lt;host&gt;&lt;name&gt;host2&lt;/name&gt;&lt;timeout&gt;123&lt;/timeout&gt;&lt;/host&gt;
  &lt;host&gt;&lt;name&gt;host3&lt;/name&gt;&lt;timeout&gt;-1&lt;/timeout&gt;&lt;/host&gt;
  &lt;host&gt;&lt;name&gt;host4, host5,host6&lt;/name&gt;&lt;timeout&gt;1800&lt;/timeout&gt;&lt;/host&gt;
&lt;/hosts&gt;
</code></pre> <p>If the file extension of the exclude file is not xml, standard one-line-per-host format is used without timeout support.</p> <pre><code>host1
host2
host3
</code></pre> <p>Note: In the future more file formats are planned with timeout support. Follow the <a href="https://issues.apache.org/jira/browse/YARN-5536" target="_blank" rel="noopener noreferrer">YARN-5536<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> if you are interested.</p> <p>Important to mention, that the timeout is not persited. In case of a RM restart/failover the node will be immediatelly decommission. (Follow the <a href="https://issues.apache.org/jira/browse/YARN-5464" target="_blank" rel="noopener noreferrer">YARN-5464<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for changes in this behavior).</p> <h3 id="client-or-server-side-timeout"><a href="#client-or-server-side-timeout" class="header-anchor">#</a> Client or server side timeout</h3> <p>Timeout of Graceful decommissioning could be tracked on server or client side. The -client|server indicates if the timeout tracking should be handled by the client or the ResourceManager. The client side tracking is blocking, while the server-side tracking is not.</p> <h3 id="rmnode-handles-decommission-events"><a href="#rmnode-handles-decommission-events" class="header-anchor">#</a> RMNode handles decommission events</h3> <p>Upon receiving GRACEFUL_DECOMMISSION event, the RMNode will save the decommissioning timeout if specified, update metrics for graceful decommission and preserve its original total capacity, and transition into DECOMMISSIONING state.</p> <p>Resources will be dynamically and periodically updated on DECOMMISSIONING RMNode so that scheduler won’t be scheduling new containers on them due to no available resources.</p> <h3 id="automatic-and-asynchronous-tracking-of-decommissioning-nodes-status"><a href="#automatic-and-asynchronous-tracking-of-decommissioning-nodes-status" class="header-anchor">#</a> Automatic and asynchronous tracking of decommissioning nodes status</h3> <p>DecommissioningNodeWatcher is the YARN component that tracks DECOMMISSIONING nodes status automatically and asynchronously after client/admin made the graceful decommission request. NM periodically send RM heart beat with it latest container status. DecommissioningNodeWatcher tracks heartbeat updates on all DECOMMISSIONING nodes to decide when, after all running containers on the node have completed, will be transitioned into DECOMMISSIONED state after which NodeManager will be told to shutdown.</p> <p>Under MR application, a node, after completes all its containers, may still serve it map output data during the duration of the application for reducers. The YARN graceful decommission mechanism keeps such DECOMMISSIONING nodes until all involved applications complete. It could be however undesirable under long-running applications scenario where a bunch of “idle” nodes might stay around for long period of time. DecommissioningNodeWatcher balances such concern with a timeout — a DECOMMISSIONING node will be DECOMMISSIONED no later than decommissioning timeout regardless of running containers or applications. If running containers finished earlier, it continues waiting for applications to finish until the decommissioning timeout. When decommissioning timeout reaches, the node will be decommissioned regardless. The node will be deactivated and owning tasks will be rescheduled as necessary.</p> <p>Status of all decommissioning node are logged periodically (every 20 seconds) in resource manager logs. Following are the sub-status of a decommissioning node:</p> <ul><li>NONE — Node is not in DECOMMISSIONING state.</li> <li>WAIT_CONTAINER — Wait for running containers to complete.</li> <li>WAIT_APP — Wait for running application to complete (after all containers complete)</li> <li>TIMEOUT — Timeout waiting for either containers or applications to complete</li> <li>READY — Nothing to wait, ready to be decommissioned</li> <li>DECOMMISSIONED — The node has already been decommissioned</li></ul> <h2 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h2> <table><thead><tr><th>Property</th> <th>Value</th></tr></thead> <tbody><tr><td>yarn.resourcemanager.nodemanager-graceful-decommission-timeout-secs</td> <td>Timeout in seconds for YARN node graceful decommission. This is the maximal time to wait for running containers and applications to complete before transition a DECOMMISSIONING node into DECOMMISSIONED. The default value is 3600 seconds. Negative value (like -1) is handled as infinite timeout.</td></tr> <tr><td>yarn.resourcemanager.decommissioning-nodes-watcher.poll-interval-secs</td> <td>Period in seconds of the poll timer task inside DecommissioningNodesWatcher to identify and take care of DECOMMISSIONING nodes missing regular heart beat. The default value is 20 seconds.</td></tr> <tr><td>yarn.resourcemanager.nodes.exclude-path</td> <td>Path to file with nodes to exclude.</td></tr> <tr><td>yarn.resourcemanager.nodes.include-path</td> <td>Path to file with nodes to include.</td></tr></tbody></table></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.03e63b66.js" defer></script><script src="/assets/js/2.fd33e103.js" defer></script><script src="/assets/js/96.4c0c4821.js" defer></script>
  </body>
</html>
